@using System
@using AuctionSystem.Client.Services
@inject ToastService ToastSvc
@implements IDisposable

<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;">
    @foreach (var t in toasts)
    {
        <div class="alert alert-@t.Type shadow mb-2" role="alert">
            @t.Text
        </div>
    }
</div>

@code {
    private List<ToastMessage> toasts = new();

    protected override void OnInitialized()
    {
        ToastSvc.OnPush += HandlePush;
    }

    private async void HandlePush(ToastMessage msg)
    {
        toasts.Add(msg);
        StateHasChanged();
        try
        {
            await Task.Delay(msg.DurationMs);
        }
        catch { }
        toasts.Remove(msg);
        StateHasChanged();
    }

    public void Dispose()
    {
        ToastSvc.OnPush -= HandlePush;
    }
}
